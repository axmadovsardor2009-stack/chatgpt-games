<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird — Single File</title>
  <style>
    :root{--bg:#70c5ce;--ground:#ded895;--pipe:#3cb371;--bird:#ffdd57}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{display:flex;align-items:center;justify-content:center;height:100%;background:linear-gradient(#70c5ce,#9ee0eb)}
    canvas{border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.25);background:linear-gradient(#9fdbe6,#d6f0f6)}
    .ui{position:fixed;top:18px;left:18px;color:#004;user-select:none}
    .hint{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);color:#003a;font-weight:600}
    .controls{display:flex;gap:.5rem;align-items:center}
    button{appearance:none;border:0;padding:.5rem .75rem;border-radius:6px;background:white;box-shadow:0 2px 6px rgba(0,0,0,.12);cursor:pointer}
    small{display:block;color:#013}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game" width="480" height="640" aria-label="Flappy bird game"></canvas>
  </div>
  <div class="ui">
    <div class="controls">
      <button id="btnRestart">Restart</button>
      <button id="btnMute">Mute</button>
      <div style="margin-left:.5rem">Score: <strong id="score">0</strong></div>
    </div>
    <small>High: <span id="high">0</span></small>
  </div>
  <div class="hint">Click / Tap / Space to flap — try to fly between the pipes</div>

  <script>
  (function(){
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    let frames = 0;
    let score = 0;
    let highScore = Number(localStorage.getItem('flappy_high') || 0);
    document.getElementById('high').textContent = highScore;
    const gravity = 0.55;
    const jumpPower = -8.5;
    let muted = false;

    const bird = {
      x: 90,
      y: H/2,
      w: 34,
      h: 24,
      vel: 0,
      rot: 0,
      alive: true,
      draw(){
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rot);
        ctx.fillStyle = 'rgb(255,221,87)';
        ctx.beginPath();
        ctx.ellipse(0,0,this.w/2,this.h/2,0,0,Math.PI*2);
        ctx.fill();
        ctx.fillStyle='#222';ctx.beginPath();ctx.arc(6,-4,3,0,Math.PI*2);ctx.fill();
        ctx.fillStyle='rgba(0,0,0,.08)';ctx.beginPath();ctx.ellipse(-2,3,8,4,0,0,Math.PI*2);ctx.fill();
        ctx.restore();
      },
      flap(){ if(!this.alive) return; this.vel = jumpPower; play('wing'); },
      update(){
        this.vel += gravity;
        this.y += this.vel;
        this.rot = Math.max(Math.min(this.vel/12, 0.6), -0.8);
        if(this.y + this.h/2 >= groundY) { this.y = groundY - this.h/2; this.alive = false; play('hit'); }
        if(this.y - this.h/2 <= 0) { this.y = this.h/2; this.vel = 0; }
      }
    };

    const groundHeight = 80;
    const groundY = H - groundHeight/2;

    const pipes = [];
    const pipeWidth = 60;
    const gap = 150;
    const pipeInterval = 110;

    function spawnPipe(){
      const min = 80, max = H - groundHeight - 80 - gap;
      const top = Math.floor(Math.random()*(max-min))+min;
      pipes.push({x: W + 10, top: top, passed:false});
    }

    const aud = {
      wing: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='),
      hit: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='),
      point: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=')
    };
    function play(name){ if(muted) return; try{ aud[name].currentTime=0; aud[name].play(); }catch(e){} }

    window.addEventListener('keydown', e=>{ if(e.code==='Space') { e.preventDefault(); bird.flap(); if(!bird.alive) restart(); } });
    canvas.addEventListener('mousedown', ()=>{ if(bird.alive) bird.flap(); else restart(); });
    canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(bird.alive) bird.flap(); else restart(); }, {passive:false});

    document.getElementById('btnRestart').addEventListener('click', restart);
    document.getElementById('btnMute').addEventListener('click', ()=>{ muted = !muted; document.getElementById('btnMute').textContent = muted ? 'Unmute' : 'Mute'; });

    function restart(){
      frames = 0; score = 0; pipes.length = 0; bird.y = H/2; bird.vel = 0; bird.alive = true; document.getElementById('score').textContent = score;
    }

    function hitsPipe(pipe){
      const bx = bird.x, by = bird.y, br = Math.max(bird.w,bird.h)/2;
      if(bx+br > pipe.x && bx-br < pipe.x + pipeWidth){
        if(by - br < pipe.top || by + br > pipe.top + gap) return true;
      }
      return false;
    }

    function loop(){
      frames++;
      if(frames % pipeInterval === 0) spawnPipe();
      if(bird.alive) bird.update();
      for(let i=pipes.length-1;i>=0;i--){
        pipes[i].x -= 2.4 + Math.min(1.6, frames/1000);
        if(!pipes[i].passed && pipes[i].x + pipeWidth < bird.x){
          pipes[i].passed = true;
          if(bird.alive){
            score++;
            document.getElementById('score').textContent = score;
            play('point');
            if(score>highScore){ highScore = score; localStorage.setItem('flappy_high', highScore); document.getElementById('high').textContent = highScore; }
          }
        }
        if(bird.alive && hitsPipe(pipes[i])){ bird.alive = false; play('hit'); }
        if(pipes[i].x + pipeWidth < -50) pipes.splice(i,1);
      }
      draw();
      requestAnimationFrame(loop);
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0,'#9adfed'); g.addColorStop(1,'#d6f0f6');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

      for(const p of pipes){
        ctx.fillStyle = '#3CB371';
        ctx.fillRect(p.x, 0, pipeWidth, p.top);
        ctx.fillRect(p.x, p.top+gap, pipeWidth, H - groundHeight - (p.top+gap));
        ctx.fillStyle = '#2e8b57';
        ctx.fillRect(p.x-6, p.top - 12, pipeWidth+12, 12);
        ctx.fillRect(p.x-6, p.top+gap, pipeWidth+12, 12);
      }

      ctx.fillStyle = '#ded895';
      ctx.fillRect(0, H-groundHeight, W, groundHeight);
      ctx.fillStyle='rgba(0,0,0,.06)';
      for(let i=0;i<W;i+=24) ctx.fillRect(i, H-groundHeight, 12, 6);

      bird.draw();

      ctx.fillStyle = 'rgba(0,0,0,0.12)';
      ctx.font = '700 68px system-ui';
      ctx.textAlign = 'center';
      ctx.fillText(score, W/2, 120);

      if(!bird.alive){
        ctx.fillStyle = 'rgba(0,0,0,0.35)'; ctx.fillRect(0,0,W,H);
        ctx.fillStyle = '#fff'; ctx.font='700 36px system-ui'; ctx.fillText('Game Over', W/2, H/2 - 40);
        ctx.font='600 20px system-ui'; ctx.fillText('Click / Tap to restart', W/2, H/2);
      }
    }

    restart();
    loop();
  })();
  </script>
</body>
</html>
